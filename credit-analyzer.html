<!--START OF CUSTOM BLOCK !-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Free Credit Analyzer | FundHub</title>

<style>
:root{
  --ink:#0f172a;
  --accent-blue:#38bdf8;
  --accent-indigo:#5b7cfa;
  --bg-dark1:#0f172a;
  --bg-dark2:#0b1220;
  --radius:16px;
}

/* Reset + Base */
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  color:var(--ink);
  background:#fff;
  overflow-x:hidden;
}

/* Header */
header{
  position:sticky;
  top:0;
  z-index:50;
  background:#fff;
  border-bottom:1px solid rgba(2,6,23,.08);
  height:68px;
  transition:background .4s,box-shadow .4s;
}
 

/* M J added and renamed header as .site-header */
.site-header.glass{
  background:rgba(15,23,42,.35)!important; 
  backdrop-filter:saturate(160%) blur(10px); 
  -webkit-backdrop-filter:saturate(160%) blur(10px); 
  border-bottom:1px solid rgba(255,255,255,.12); 
  box-shadow:0 6px 18px rgba(2,6,23,.25);
}
.site-header.glass .logo-dark{
  display:none;
}
.site-header.glass .logo-light{
  display:block;
}
.site-header.glass .nav a{
  color:#fff!important;
}

.site-header.glass .nav a:hover{
  background:rgba(255,255,255,.10);
  border-color:rgba(255,255,255,.18);
}
  
.header-inner{
  /* max-width:1140px; */
  max-width: 85vw;
  margin:auto;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 20px;
}
@media(max-width:600px){
  .header-inner{
    max-width:100%;
  }
}
/* End header edit */
  
.brand img{
  height:28px; /* M J 32px to 28px consistent sizing */
  width:auto;
  object-fit:contain;
}
  
/* M J disappear white logo top*/
.logo-light{
  display:none;
}
/* End of M J remove white logo when top */

header.scrolled{
  background:rgba(255,255,255,.9);
  backdrop-filter:blur(6px);
  box-shadow:0 4px 16px rgba(0,0,0,.06);
}

/* M J align mobile nav */
nav {
  display:flex;
  text-align:center;
}
  
header .nav a{
  color:var(--ink);
  text-decoration:none;
  font-weight:600;
  font-size:14px;
  padding:8px 10px;
  border-radius:8px;
  transition:all .2s;
}
/* M J readability edit*/
header .nav a:hover{
  background:rgba(2,6,23,.06);
}
.cta{
  font-weight:700;
  /*border:1px solid transparent; remove border around Book Call*/
}
/* End of M J readability edit */

/* ===== TOP HERO SECTION ===== */
.video-hero{
  position:relative;
  background:#fff;
  padding:110px 40px 100px;
  overflow:hidden;
}
.video-hero::before{
  content:"";
  position:absolute;
  top:-10%;
  left:-10%;
  width:120%;
  height:120%;
  background:radial-gradient(800px 400px at 30% 20%, rgba(59,130,246,.08), transparent 70%);
  animation:floatBg 12s ease-in-out infinite alternate;
  z-index:0;
}
@keyframes floatBg{
  0%{transform:translateY(0);}
  100%{transform:translateY(40px);}
}
.video-hero .inner{
  position:relative;
  z-index:1;
  max-width:90vw;
  margin:auto;
  display:grid;
  grid-template-columns:1.1fr .9fr;
  gap:80px;
  align-items:center;
  animation:fadeUp 1.2s ease both;
}
@media(max-width:980px){
  .video-hero .inner{
    grid-template-columns:1fr;
    gap:40px;
  }
}
  
@keyframes fadeUp{
  from{opacity:0;transform:translateY(30px);}
  to{opacity:1;transform:none;}
}

.video-hero h1{
  font-size:46px;
  line-height:1.1;
  font-weight:900;
  margin:0 0 12px;
}

/* Gradient */
.video-hero h1 .blue{
  background:linear-gradient(90deg,var(--accent-blue),var(--accent-indigo));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
  
@media(max-width:600px){
  .video-hero h1{
    font-size: 1.9em;
  }
    
  .video-hero {
    padding: 110px 0px 100px;
  }
}

.video-hero p.lead{
  font-size:18px;
  color:#475569;
  line-height:1.5;
  margin-bottom:18px;
  font-weight:500;
}

.video-hero ul{
  list-style:disc;
  margin:0;
  padding-left:20px;
  color:#334155;
  font-weight:500;
}

.video-hero li{margin-bottom:6px;}

/* ---- UPDATED: VIDEO SCALE ---- */
.video-wrap{
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 12px 40px rgba(0,0,0,.12);
  /*transform:scale(1.32); M J removed video scale as 90vw already makes video large*/
  aspect-ratio:16/9; /*M J set aspect to remove white bordering at bottom */
  transform-origin:center;
  height: 27vw;
}
@media(max-width:600px){
  .video-wrap{
    height:100%;
  }
}
  

.video-wrap iframe{
  width:100%;
  aspect-ratio:16/9;
  border:none;
}

/* Rotating text */
.rotator{
  display:inline-grid;
  position:relative;
  color:var(--accent-indigo);
  font-weight:900;
}
  
/*.rotator .word{
  grid-area:1/1;
  opacity:0;
  transform:translateY(20%) scale(.98);
  transition:opacity .45s ease,transform .45s ease;
}*/
.rotator .word{
  grid-area:1/1;
  opacity:0;
  transform:scale(.98);
  filter:blur(.25px);
  transition:opacity .35s ease, transform .35s ease, filter .35s ease;
  white-space:nowrap;
}  
  
/*.rotator .word.active{
  opacity:1;
  transform:translateY(0) scale(1);
}*/
.rotator .word.active{
  opacity:1;
  transform: scale(1);
  filter:blur(0);
}

/* ===== BLUE ANALYZER SECTION ===== */
.blue-hero{
  background:
    radial-gradient(1200px 600px at 10% 10%, rgba(24,164,255,.18), transparent 60%),
    radial-gradient(1000px 600px at 80% 20%, rgba(34,211,163,.14), transparent 60%),
    linear-gradient(180deg,var(--bg-dark1) 0%, var(--bg-dark2) 100%);
  color:#fff;
  min-height:calc(100vh - 68px);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:80px 20px;
}
.card{
  max-width:820px;
  width:100%;
  background:rgba(15,23,42,.68);
  border:1px solid rgba(255,255,255,.08);
  border-radius:var(--radius);
  box-shadow:0 16px 40px rgba(0,0,0,.45);
  padding:40px;
  backdrop-filter:blur(12px);
}
.card h2{
  font-size:32px;
  font-weight:900;
  margin:0 0 10px;
}
.card p.sub{
  font-size:16px;
  color:rgba(255,255,255,.9);
  margin-bottom:18px;
  line-height:1.6;
}

/* Form */
.error {
  border: 2px solid #ff4d4d !important;
  box-shadow: 0 0 6px rgba(255, 0, 0, 0.6);
}

.error-message {
  color: #ff4d4d;
  font-size: 0.75rem;
  margin-top: 4px;
  display: block;
}
  
form{
  display:flex;
  flex-direction:column;
  gap:14px;
}
input,button{font-family:inherit;}
input[type=text],
input[type=email],
input[type=number],
input[type=file],
input[type=tel]{
  padding:12px 14px;
  border-radius:10px;
  border:none;
  font-size:15px;
  background:rgba(255,255,255,.08);
  color:#fff;
}
input::file-selector-button{
  background:linear-gradient(135deg,#5b7cfa,#38bdf8);
  border:none;
  padding:8px 12px;
  border-radius:6px;
  color:#fff;
  font-weight:600;
  cursor:pointer;
  margin-right:10px;
}
label{
  font-size:14px;
  color:rgba(255,255,255,.85);
}

/* Submit Button */
button.submit{
  position:relative;
  overflow:hidden;
  padding:14px 0;
  border:none;
  border-radius:10px;
  background:linear-gradient(135deg,#5b7cfa,#38bdf8);
  color:#fff;
  font-weight:800;
  font-size:15px;
  cursor:pointer;
  transition:all .25s ease;
  box-shadow:0 0 18px rgba(91,124,250,.45);
}
button.submit span{
  position:relative;
  z-index:2;
}

button.submit::before{
  content:"";
  position:absolute;
  left:0;
  top:0;
  height:100%;
  width:var(--progress, 0%);
  background:#4DB877;
  z-index:1;
  transition:width 0.15s linear;
}
button.submit::after{
  content:"";
  position:absolute;
  top:0;
  left:0;
  height:100%;
  width:var(--progress, 0%);
  background:#4DB877;
  opacity:0.55;
  filter:blur(22px);
  z-index:0;
  transition:width 0.15s linear;
}

button.submit.loading{
  cursor:default;
  pointer-events:none;
  box-shadow:none;
}
  
/* M J submit button and file selector button */
#fh_file::file-selector-button:hover{
  transform:translateY(-2px); 
  box-shadow:0 12px 28px rgba(24,164,255,.32);
}
  
#fh_analyze:hover{
  transform:translateY(-2px); 
  box-shadow:0 12px 28px rgba(24,164,255,.32);
}
/* End of  M J submit button and file selector button */
  
/* Credit links */
.credit-links{
  display:flex;
  justify-content:center;
  gap:16px;
  margin-top:20px;
}
.credit-links a{
  color:#fff;
  text-decoration:none;
  font-size:14px;
  padding:8px 14px;
  border-radius:6px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(255,255,255,.05);
  transition:all .25s ease;
}
.credit-links a:hover{
  background:rgba(255,255,255,.15);
  border-color:rgba(255,255,255,.4);
  transform:translateY(-1px);
}

small.hint{color:rgba(255,255,255,.7);}
.error-banner{
  display:none;
  margin-top:10px;
  padding:10px 12px;
  border-radius:8px;
  background:#fecaca;
  color:#7f1d1d;
  border:1px solid #fca5a5;
}
#resultBox{
  margin-top:14px;
  font-size:15px;
  color:#fff;
}
.footerNote{
  text-align:center;
  margin-top:18px;
  color:rgba(255,255,255,.65);
  font-size:13px;
}
</style>

<script>
(function initUWIDevice() {
  window.__config = window.__config || {};
  if (typeof window.__config.AFFILIATE_DASHBOARD_ENABLED === "undefined") {
    window.__config.AFFILIATE_DASHBOARD_ENABLED = "false";
  }
  if (typeof window.__config.IDENTITY_VERIFICATION_ENABLED === "undefined") {
    window.__config.IDENTITY_VERIFICATION_ENABLED = "true";
  }

  const affiliateOn = window.__config.AFFILIATE_DASHBOARD_ENABLED === "true";
  const DEVICE_KEY = "uwiq_device_id_v1";
  const LAST_RESULT_KEY = "uwiq_last_result_v1";
  const LAST_REF_KEY = "uwiq_last_ref_v1";
  const LAST_EXP_KEY = "uwiq_last_result_expiry_v1";

  function generateId() {
    const rand = Math.random().toString(16).slice(2, 10);
    return `dev-${Date.now()}-${rand}`;
  }

  function getDeviceId() {
    try {
      const existing = localStorage.getItem(DEVICE_KEY);
      if (existing) return existing;
      const next = generateId();
      localStorage.setItem(DEVICE_KEY, next);
      return next;
    } catch (_) {
      return "anonymous-device";
    }
  }

  function extractRefFromUrl(url) {
    if (!url) return null;
    try {
      const u = new URL(url, window.location.href);
      return u.searchParams.get("ref");
    } catch (_) {
      return null;
    }
  }

  function saveLastResult(url, refId, daysRemaining) {
    try {
      if (url) localStorage.setItem(LAST_RESULT_KEY, url);
      if (refId) localStorage.setItem(LAST_REF_KEY, refId);
      const ttlDays = Number(daysRemaining);
      const days = Number.isFinite(ttlDays) && ttlDays > 0 ? ttlDays : 30;
      const exp = Date.now() + days * 24 * 60 * 60 * 1000;
      localStorage.setItem(LAST_EXP_KEY, String(exp));
    } catch (_) {}
  }

  let forceResubmit = false;
  let targetRef = null;
  let lastResult = null;
  let expiry = null;

  try {
    const params = new URLSearchParams(window.location.search || "");
    forceResubmit = params.get("forceResubmit") === "1";
    targetRef = params.get("ref") || null;
    lastResult = localStorage.getItem(LAST_RESULT_KEY);
    const storedRef = localStorage.getItem(LAST_REF_KEY) || extractRefFromUrl(lastResult);
    if (!targetRef && storedRef) targetRef = storedRef;
    expiry = Number(localStorage.getItem(LAST_EXP_KEY)) || null;
  } catch (_) {}

  const deviceId = getDeviceId();
  window.__uwiq = { deviceId, saveLastResult };

  const now = Date.now();
  const hasValidTtl = expiry ? expiry > now : true;

  if (affiliateOn) {
    if (!forceResubmit && targetRef && hasValidTtl) {
      window.__uwiqRedirecting = true;
      const dashUrl = `/referral-dashboard.html?ref=${encodeURIComponent(targetRef)}`;
      window.location.replace(dashUrl);
      return;
    }

    if (!forceResubmit && !targetRef && lastResult && hasValidTtl) {
      const refFromUrl = extractRefFromUrl(lastResult);
      if (refFromUrl) {
        window.__uwiqRedirecting = true;
        const dashUrl = `/referral-dashboard.html?ref=${encodeURIComponent(refFromUrl)}`;
        window.location.replace(dashUrl);
        return;
      }
    }
  }
})();
</script>
</head>

<body>

<!-- M J changed class and id, img -->
<header class="site-header" id="site-header">
  <div class="header-inner">
    <a class="brand" href="https://fundhub.ai/start-here">
      <img class="logo-dark"  src="https://storage.googleapis.com/msgsndr/ORh91GeY4acceSASSnLR/media/68c82a9b57da562581fb8828.png" alt="FundHub">
      <img class="logo-light" src="https://storage.googleapis.com/msgsndr/ORh91GeY4acceSASSnLR/media/68c834144f724eae4137ce4c.png" alt="FundHub">
    </a>
    <nav class="nav">
      <a href="#video">How It Works</a>
      <a href="#analyzer">Analyzer</a>
      <!-- UPDATED BOOK CALL LINK -->
      <!--<a class="cta" href="https://fundhub.ai/funding-form-748297" target="_blank">Book Call</a>-->
      <a class="cta" id="bookcallbutton">Book a Call</a>
    </nav>
  </div>
</header>

<section class="video-hero" id="video">
  <div class="inner">
    <div>
      <h1>
        See Exactly How Much Funding You Can Get —<br>
        <span class="rotator">
          <span class="word active">Before You Apply.</span>
          <span class="word">Risk Free.</span>
          <span class="word">In Under 60 Seconds.</span>
        </span>
      </h1>
      <p class="lead">
        Our AI, <strong>Underwrite IQ™</strong>, breaks down your credit report the same way banks do — revealing your true unlocked funding potential.
      </p>
      <ul>
        <li>Instant lender-style credit analysis</li>
        <li>See what’s holding you back</li>
        <li>Get dispute letters + roadmap to lender-ready</li>
      </ul>
    </div>

    <div>
      <div class="video-wrap">
        <iframe src="https://www.youtube.com/embed/VIDEO_ID?rel=0&modestbranding=1" allowfullscreen></iframe>
      </div>
    </div>
  </div>
</section>

<section class="blue-hero" id="analyzer">
  <div class="card">
    <h2>Free Credit Analyzer</h2>
    <p class="sub">Upload up to 3 PDF credit reports.</p>

    <form id="fh_form" enctype="multipart/form-data">
      <input id="fh_name" type="text" placeholder="Full Name" required>
      <input id="fh_email" type="email" placeholder="Email Address" required>
      <input id="fh_phone" type="tel" placeholder="Phone Number" required>
      <input id="fh_biz" type="text" placeholder="Business Name (optional)">
      <input id="fh_biz_age" type="number" placeholder="Business Age (months)">
      <input id="fh_file" type="file" name="file" accept=".pdf" multiple required>

      <small class="hint">Upload real PDF reports (no photos).</small>

      <label>
        <input id="fh_consent" type="checkbox" required>
        I authorize FundHub.ai to review my report.
      </label>

      <button class="submit" id="fh_analyze" type="button">
        <span>Analyze My Report</span>
      </button>

      <div class="credit-links">
        <a href="https://www.annualcreditreport.com/" target="_blank">Get Experian</a>
        <a href="https://www.annualcreditreport.com/" target="_blank">Get TransUnion</a>
        <a href="https://www.annualcreditreport.com/" target="_blank">Get Equifax</a>
      </div>

      <div id="errorBox" class="error-banner"></div>
      <div id="resultBox"></div>
    </form>

    <div class="footerNote">No Credit Impact • Secure & Encrypted • No Data Sharing</div>
  </div>
</section>

<script>
/* Duplicate submission handler intentionally disabled to prevent double requests. */
/*
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("fh_form");
  const btn = document.getElementById("fh_analyze");
  const errorBox = document.getElementById("errorBox");

  // ✅ Use switchboard (correct orchestrator)
  const ANALYZER_URL = "https://underwrite-iq-lite.vercel.app/api/lite/switchboard";

  function showError(msg) {
    errorBox.style.display = "block";
    errorBox.textContent = msg;
  }

  function clearError() {
    errorBox.style.display = "none";
    errorBox.textContent = "";
  }

  function setButtonLoading(isLoading) {
    if (isLoading) {
      btn.classList.add("loading");
      btn.style.setProperty("--progress", "100%");
      btn.querySelector("span").textContent = "Analyzing…";
    } else {
      btn.classList.remove("loading");
      btn.style.setProperty("--progress", "0%");
      btn.querySelector("span").textContent = "Analyze My Report";
    }
  }

  btn.addEventListener("click", async () => {
    clearError();

    if (typeof window.fhCanAnalyze === "function" && !window.fhCanAnalyze()) {
      showError("Please complete all required fields before analyzing.");
      return;
    }

    const name = document.getElementById("fh_name").value.trim();
    const email = document.getElementById("fh_email").value.trim();
    const phone = document.getElementById("fh_phone").value.trim();
    const consent = document.getElementById("fh_consent").checked;
    const bizName = document.getElementById("fh_biz").value || "";
    const bizAge = document.getElementById("fh_biz_age").value || "";
    const filesInput = document.getElementById("fh_file");
    const files = filesInput.files;

    if (!name || !email || !phone) {
      showError("Please fill in your name, email, and phone.");
      return;
    }

    if (!consent) {
      showError("You must authorize FundHub.ai to review your report.");
      return;
    }

    if (!files || files.length === 0) {
      showError("Please upload at least one PDF file.");
      return;
    }

    // ✅ Validate all uploaded files are PDFs
    const allPdf = Array.from(files).every(f =>
      f.type === "application/pdf" || f.name.toLowerCase().endsWith(".pdf")
    );
    if (!allPdf) {
      showError("Only PDF files are allowed.");
      return;
    }

    setButtonLoading(true);

    try {
      const fd = new FormData();
      fd.append("name", name);
      fd.append("email", email);
      fd.append("phone", phone);
      fd.append("businessName", bizName);
      fd.append("businessAgeMonths", bizAge);

      // ✅ Send ALL selected PDFs (1–3) to backend
      Array.from(files).forEach(f => fd.append("file", f));

      const resp = await fetch(ANALYZER_URL, {
        method: "POST",
        body: fd
      });

      let out;
      try {
        out = await resp.json();
      } catch (e) {
        console.error("Failed to parse JSON:", e);
        showError("Unexpected response from analyzer. Please try again.");
        setButtonLoading(false);
        return;
      }

      if (!out || out.ok === false) {
        showError(
          (out && (out.reason || out.msg))
            ? (out.reason || out.msg)
            : "Unable to analyze this file. Please upload a standard credit report PDF."
        );
        setButtonLoading(false);
        return;
      }

      if (!out.redirect || !out.redirect.url) {
        showError("Analyzer finished, but no redirect destination was provided.");
        setButtonLoading(false);
        return;
      }

      const qs = new URLSearchParams(out.redirect.query || {}).toString();
      const finalUrl = out.redirect.url + (qs ? "?" + qs : "");

      window.location.href = finalUrl;

    } catch (err) {
      console.error("Analyzer error:", err);
      showError("Something went wrong while analyzing your report. Please try again.");
      setButtonLoading(false);
      return;
    }

    setButtonLoading(false);
  });
});
*/
</script>

</body>
</html>
<!-- END OF CUSTOM BLOCK 1 -->
<!--START OF CUSTOM BLOCK 2-->

<script>
document.addEventListener("DOMContentLoaded", function () {
  if (window.__uwiqRedirecting) return;
  
  /* ---------------------------
        BOOK CALL BUTTON MIRROR
  ----------------------------*/
  const customSurvey = document.getElementById("bookcallbutton");
  const ghlBtn = document.querySelector('#button-s_vCdycJLf_btn');

  if (customSurvey && ghlBtn) {
    customSurvey.addEventListener("click", () => ghlBtn.click());
  }

  const byId = id => document.getElementById(id);

  /* ---------------------------
        CORRECT BACKEND URL
  ----------------------------*/
  const API_BASE = "https://underwrite-iq-lite.vercel.app";

  /* ---------------------------
        ROTATING HEADLINE
  ----------------------------*/
  (function setupRotator() {
    const rotator = document.querySelector(".rotator");
    if (!rotator) return;

    const words = Array.from(rotator.querySelectorAll(".word"));
    if (!words.length) return;

    let index = 0;
    words.forEach((w, i) => w.classList.toggle("active", i === 0));

    setInterval(() => {
      words[index].classList.remove("active");
      index = (index + 1) % words.length;
      words[index].classList.add("active");
    }, 2200);
  })();

  /* ---------------------------
        VALIDATION HELPERS
  ----------------------------*/
  function formatFullName(name) {
    const parts = name.trim().split(/\s+/).filter(Boolean);
    if (parts.length < 2) return null;
    return parts
      .map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase())
      .join(" ");
  }

  function isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(email).toLowerCase());
  }

  function isValidPhone(phone) {
    return (phone || "").replace(/\D/g, "").length === 10;
  }

  /* ---------------------------
        REMOTE FIELD VALIDATION
  ----------------------------*/
  const validationState = {
    emailValid: false,
    phoneValid: false,
    businessValid: true
  };

  const validationTokens = { email: 0, phone: 0, business: 0 };

  function debounce(fn, delay) {
    let t;
    return (...args) => {
      clearTimeout(t);
      t = setTimeout(() => fn(...args), delay);
    };
  }

  function applyValidation(key, inputEl, isValid, message) {
    validationState[key] = !!isValid;
    if (isValid) {
      setError(inputEl);
    } else if (message !== undefined) {
      setError(inputEl, message);
    }
    updateAnalyzeState();
  }

  function updateAnalyzeState() {
    const btn = byId("fh_analyze");
    const consentInput = byId("fh_consent");
    const filesInput = byId("fh_file");
    const bizInput = byId("fh_biz");

    const bizValue = (bizInput && bizInput.value || "").trim();
    const businessReady = bizValue ? validationState.businessValid : true;
    const hasFiles = !!(filesInput && filesInput.files && filesInput.files.length);
    const ready = validationState.emailValid &&
                  validationState.phoneValid &&
                  businessReady &&
                  !!(consentInput && consentInput.checked) &&
                  hasFiles;

    if (btn) btn.disabled = !ready;
    return ready;
  }

  // Expose a read hook for other scripts on the page.
  window.fhCanAnalyze = updateAnalyzeState;

  function validateEmailBackend() {
    const input = byId("fh_email");
    if (!input) return;

    const value = input.value.trim();
    if (!value) {
      applyValidation("emailValid", input, false, "");
      return;
    }

    if (!isValidEmail(value)) {
      applyValidation("emailValid", input, false, "Please enter a valid email address.");
      return;
    }

    const token = ++validationTokens.email;
    fetch(API_BASE + "/api/lite/validate/email", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email: value })
    })
      .then(r => r.json().catch(() => ({})))
      .then(data => {
        if (token !== validationTokens.email) return;
        if (data && data.ok) {
          applyValidation("emailValid", input, true);
        } else {
          applyValidation(
            "emailValid",
            input,
            false,
            data?.msg || data?.error || "Email validation failed."
          );
        }
      })
      .catch(() => {
        if (token !== validationTokens.email) return;
        applyValidation("emailValid", input, false, "Email validation unavailable.");
      });
  }

  function validatePhoneBackend() {
    const input = byId("fh_phone");
    if (!input) return;

    const value = input.value.trim();
    const digits = value.replace(/\D/g, "");
    if (!digits) {
      applyValidation("phoneValid", input, false, "");
      return;
    }

    if (!isValidPhone(value)) {
      applyValidation("phoneValid", input, false, "Enter a full valid phone number.");
      return;
    }

    const token = ++validationTokens.phone;
    fetch(API_BASE + "/api/lite/validate/phone", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ phone: value })
    })
      .then(r => r.json().catch(() => ({})))
      .then(data => {
        if (token !== validationTokens.phone) return;
        if (data && data.ok) {
          applyValidation("phoneValid", input, true);
        } else {
          applyValidation(
            "phoneValid",
            input,
            false,
            data?.msg || data?.error || "Phone validation failed."
          );
        }
      })
      .catch(() => {
        if (token !== validationTokens.phone) return;
        applyValidation("phoneValid", input, false, "Phone validation unavailable.");
      });
  }

  function validateBusinessBackend() {
    const input = byId("fh_biz");
    if (!input) return;

    const value = input.value.trim();
    if (!value) {
      applyValidation("businessValid", input, true);
      return;
    }

    if (value.length < 2) {
      applyValidation("businessValid", input, false, "Please enter a valid business name.");
      return;
    }

    const token = ++validationTokens.business;
    fetch(API_BASE + "/api/lite/validate/business", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ business: value })
    })
      .then(r => r.json().catch(() => ({})))
      .then(data => {
        if (token !== validationTokens.business) return;
        if (data && data.ok !== false) {
          applyValidation("businessValid", input, true);
        } else {
          applyValidation(
            "businessValid",
            input,
            false,
            data?.msg || data?.error || "Business validation failed."
          );
        }
      })
      .catch(() => {
        if (token !== validationTokens.business) return;
        applyValidation("businessValid", input, false, "Business validation unavailable.");
      });
  }

  const emailInput = byId("fh_email");
  if (emailInput) {
    const debouncedEmail = debounce(validateEmailBackend, 2500);
    emailInput.addEventListener("input", () => {
      validationState.emailValid = false;
      debouncedEmail();
      updateAnalyzeState();
    });
    emailInput.addEventListener("blur", validateEmailBackend);
  }

  const phoneInput = byId("fh_phone");
  if (phoneInput) {
    const debouncedPhone = debounce(validatePhoneBackend, 2500);
    phoneInput.addEventListener("input", () => {
      validationState.phoneValid = false;
      debouncedPhone();
      updateAnalyzeState();
    });
    phoneInput.addEventListener("blur", validatePhoneBackend);
  }

  const bizInput = byId("fh_biz");
  if (bizInput) {
    const debouncedBiz = debounce(validateBusinessBackend, 2500);
    bizInput.addEventListener("input", () => {
      const hasValue = !!bizInput.value.trim();
      validationState.businessValid = hasValue ? false : true;
      debouncedBiz();
      updateAnalyzeState();
    });
    bizInput.addEventListener("blur", validateBusinessBackend);
  }

  const consentInput = byId("fh_consent");
  if (consentInput) consentInput.addEventListener("change", updateAnalyzeState);

  const filesInput = byId("fh_file");
  if (filesInput) filesInput.addEventListener("change", updateAnalyzeState);

  // Initialize disabled state on load.
  updateAnalyzeState();

  /* ---------------------------
        BUTTON PROGRESS UI
  ----------------------------*/
  function setProgress(percent) {
    const btn = byId("fh_analyze");
    if (!btn) return;
    btn.classList.add("loading");
    btn.style.setProperty("--progress", percent + "%");
    const span = btn.querySelector("span");
    if (span) span.textContent = "Analyzing…";
  }

  function resetButton() {
    const btn = byId("fh_analyze");
    if (!btn) return;
    btn.classList.remove("loading");
    btn.style.setProperty("--progress", "0%");
    const span = btn.querySelector("span");
    if (span) span.textContent = "Analyze My Report";
  }

  /* ---------------------------
          MAIN BUTTON LOGIC
  ----------------------------*/
  const analyze = byId("fh_analyze");
  if (!analyze) return;

  analyze.addEventListener("click", () => {
    const nameInput    = byId("fh_name");
    const emailInput   = byId("fh_email");
    const phoneInput   = byId("fh_phone");
    const bizInput     = byId("fh_biz");
    const ageInput     = byId("fh_biz_age");
    const filesInput   = byId("fh_file");
    const consentInput = byId("fh_consent");

    const err = byId("errorBox");
    const box = byId("resultBox");

    if (err) {
      err.style.display = "none";
      err.textContent = "";
    }
    if (box) box.textContent = "";

    if (typeof window.fhCanAnalyze === "function" && !window.fhCanAnalyze()) {
      err.style.display = "block";
      err.textContent = "Please complete all required fields before analyzing.";
      return;
    }

    /* ---------------------------
          FORM VALIDATION
    ----------------------------*/
    const formattedName = formatFullName(nameInput.value);
    if (!formattedName) {
      err.style.display = "block";
      err.textContent = "Please enter your full legal name.";
      return;
    }
    nameInput.value = formattedName;

    if (!isValidEmail(emailInput.value)) {
      err.style.display = "block";
      err.textContent = "Enter a valid email.";
      return;
    }

    if (!isValidPhone(phoneInput.value)) {
      err.style.display = "block";
      err.textContent = "Enter a valid 10-digit phone.";
      return;
    }

    if (!consentInput.checked) {
      err.style.display = "block";
      err.textContent = "You must authorize FundHub.ai to review your report.";
      return;
    }

    if (!filesInput.files || !filesInput.files.length) {
      err.style.display = "block";
      err.textContent = "Please upload at least 1 PDF.";
      return;
    }

    /* ---------------------------
          FORM DATA BUILD
    ----------------------------*/
    const fd = new FormData();
    fd.append("name", formattedName);
    fd.append("email", emailInput.value);
    fd.append("phone", phoneInput.value);
    fd.append("businessName", bizInput.value);
    fd.append("businessAgeMonths", ageInput.value);
    if (window.__uwiq && window.__uwiq.deviceId) {
      fd.append("deviceId", window.__uwiq.deviceId);
    }

    Array.from(filesInput.files).forEach(f => fd.append("file", f));

    const totalSize = Array.from(filesInput.files)
      .reduce((s, f) => s + f.size, 0);

    /* ---------------------------
          XHR WITH PROGRESS
    ----------------------------*/
    const xhr = new XMLHttpRequest();

    /* FIXED HERE ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓ */
    xhr.open("POST", API_BASE + "/api/lite/switchboard", true);
    /* FIXED HERE ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑ */

    xhr.upload.onprogress = evt => {
      if (!evt.lengthComputable || !totalSize) return;
      let pct = (evt.loaded / totalSize) * 80;
      if (pct > 80) pct = 80;
      setProgress(pct);
    };

    let suspenseStarted = false;

    xhr.onreadystatechange = () => {
      if ((xhr.readyState === 2 || xhr.readyState === 3) && !suspenseStarted) {
        suspenseStarted = true;
        let suspense = 80;
        const timer = setInterval(() => {
          suspense += 0.9;
          if (suspense >= 95 || xhr.readyState === 4) {
            clearInterval(timer);
          } else {
            setProgress(suspense);
          }
        }, 100);
      }

      if (xhr.readyState === 4) {
        setProgress(100);

        try {
          const out = JSON.parse(xhr.responseText || "{}");
          if (!out.ok) throw new Error(out.msg || "Processing failed");

          const redirect = out.redirect || {};
          const affiliateOn = window.__config && window.__config.AFFILIATE_DASHBOARD_ENABLED === "true";
          const refId = redirect.refId || redirect.ref || null;
          const resultUrl =
            redirect.resultUrl ||
            redirect.url ||
            (redirect.query ? redirect.query.url : null) ||
            "";
          const dashboardUrl = affiliateOn && refId
            ? `/referral-dashboard.html?ref=${encodeURIComponent(refId)}`
            : null;

          if (window.__uwiq && typeof window.__uwiq.saveLastResult === "function") {
            window.__uwiq.saveLastResult(dashboardUrl || resultUrl, refId, redirect.daysRemaining);
          }

          const target = dashboardUrl || resultUrl || "/";

          setTimeout(() => {
            window.location.href = target;
          }, 150);

        } catch (e) {
          err.style.display = "block";
          err.textContent = "⚠️ " + (e.message || "Unexpected error.");
          box.textContent = "";
          resetButton();
        }
      }
    };

    xhr.onerror = () => {
      err.style.display = "block";
      err.textContent = "⚠️ Network error.";
      resetButton();
    };

    setProgress(0);
    xhr.send(fd);
  });

});
</script>
<!-- END OF CUSTOM BLOCK 2 -->
 <!-- JS FOOTER TRACKING CODE -->
  <script>
  // Helper: create or update error message below inputs
    function setError(input, message = "") {
        let errorEl = input.nextElementSibling;
        
        // If next element is NOT an error message, create one
        if (!errorEl || !errorEl.classList.contains("error-message")) {
            errorEl = document.createElement("small");
            errorEl.className = "error-message";
            input.insertAdjacentElement("afterend", errorEl);
        }

        // Apply or clear error
        if (message) {
            input.classList.add("error");
            errorEl.textContent = message;
        } else {
            input.classList.remove("error");
            errorEl.textContent = "";
        }
    }
  
    // ========================
    // NAME VALIDATION & FORMAT
    // ========================
  
    const nameField = document.getElementById("fh_name");
    nameField.addEventListener("input", function(e) {
        let val = e.target.value;

        // Remove special characters
        val = val.replace(/[^a-zA-Z\s]/g, "");

        // Title case formatting
        val = val.replace(/\b\w/g, c => c.toUpperCase())
                 .replace(/\B\w/g, c => c.toLowerCase());

        e.target.value = val;

        // Validation rules
        if (val.length < 2) {
            setError(nameField, "Name must be at least 2 characters.");
        } else {
            setError(nameField);
        }
    });
  
    // ========================
    // EMAIL VALIDATION
    // ========================
  
    const emailField = document.getElementById("fh_email");
    emailField.addEventListener("input", function(e) {
        const value = e.target.value.trim();
        //const valid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
        const valid = /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/.test(value);

        if (!valid) {
            setError(emailField, "Please enter a valid email address.");
        } else {
            setError(emailField);
        }
    });
  
    // ========================
    // PHONE FORMAT
    // ========================
  
    const phoneField = document.getElementById("fh_phone");
    phoneField.addEventListener("input", function(e) {
        let v = e.target.value.replace(/\D/g, "");

        if (v.length > 3 && v.length <= 6) {
            v = `(${v.slice(0,3)}) ${v.slice(3)}`;
        } else if (v.length > 6) {
            v = `(${v.slice(0,3)}) ${v.slice(3,6)}-${v.slice(6,10)}`;
        }

        e.target.value = v;

        if (v.length < 14) {
            setError(phoneField, "Enter a full valid phone number.");
        } else {
            setError(phoneField);
        }
    });
  
    // ========================
    // BUSINESS AGE
    // ========================
  
    const ageField = document.getElementById("fh_biz_age");
    ageField.addEventListener("input", function(e) {
        let v = parseInt(e.target.value) || 0;

        if (v <= 0) v = "";
        if (v > 600) v = 600;

        e.target.value = v;

        /*if (v < 0 ) {
            setError(ageField, "Business age cannot be negative.");
        } else {
            setError(ageField);
        }*/
    });


 // M J added js for dynamic header scroll 
(function(){
  const header = document.getElementById('site-header');

  function onScroll(){ 
  (window.scrollY>8)?header.classList.add('glass'):header.classList.remove('glass'); 
  }
  onScroll(); 
  window.addEventListener('scroll', onScroll, {passive:true});
})();
// End of M J added js for dynamic header scroll 
</script>
<!-- END OF JS FOOTER TRACKING CODE -->
